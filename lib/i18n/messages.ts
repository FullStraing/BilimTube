export const LOCALES = ['ru', 'en', 'ky'] as const;
export type Locale = (typeof LOCALES)[number];

const DEFAULT_LOCALE: Locale = 'ru';

type Messages = Record<string, string>;

const messagesByLocale: Record<Locale, Messages> = {
  ru: {
    'nav.home': 'Главная',
    'nav.shorts': 'Shorts',
    'nav.categories': 'Разделы',
    'nav.favorites': 'Избранное',
    'nav.profile': 'Профиль',
    'common.video': 'Видео',
    'common.shorts': 'Shorts',
    'home.greeting': 'Привет, {name}!',
    'home.searchPlaceholder': 'Поиск по названию или категории',
    'home.allCategories': 'Все категории',
    'home.allAges': 'Все возрасты',
    'home.feedLoadError': 'Не удалось загрузить ленту. Попробуйте обновить страницу.',
    'home.feedEmpty': 'По выбранным фильтрам видео не найдено.',
    'favorites.title': 'Избранное',
    'favorites.loginRequired': 'Войдите в аккаунт, чтобы сохранять и смотреть избранные видео.',
    'favorites.empty': 'Вы пока ничего не добавили в избранное.',
    'categories.title': 'Разделы',
    'categories.subtitle': 'Выберите категорию видео',
    'categories.videoCount': '{count} видео',
    'profile.title': 'Профиль',
    'profile.interests': 'Интересы:',
    'profile.videos': 'Видео',
    'profile.tests': 'Тесты',
    'profile.favorites': 'Избранное',
    'profile.language': 'Язык',
    'profile.history': 'История просмотров',
    'profile.settings': 'Настройки',
    'profile.parental': 'Родительский контроль',
    'profile.switch': 'Сменить профиль',
    'profile.noChildTitle': 'Профиль ребенка не создан',
    'profile.noChildDescription': 'Создайте профиль, чтобы открыть родительские настройки.',
    'profile.createChild': 'Создать профиль',
    'language.title': 'Язык',
    'language.subtitle': 'Выберите язык интерфейса',
    'language.save': 'Сохранить',
    'language.saved': 'Язык обновлен',
    'language.saveError': 'Не удалось обновить язык',
    'language.ru': 'Русский',
    'language.en': 'English',
    'language.ky': 'Кыргызча',
    'shorts.title': 'Shorts',
    'shorts.openVideo': 'Открыть видео',
    'shorts.nowPlaying': 'Сейчас воспроизводится',
    'shorts.swipeHint': 'Прокрутите вверх/вниз',
    'shorts.favoriteBadge': 'В избранном',
    'shorts.empty': 'Пока нет shorts для этого профиля.',
    'history.title': 'История просмотров',
    'history.subtitle': 'Последние просмотренные видео и shorts',
    'history.empty': 'История пока пустая. Откройте любое видео или shorts, и оно появится здесь.'
  },
  en: {
    'nav.home': 'Home',
    'nav.shorts': 'Shorts',
    'nav.categories': 'Categories',
    'nav.favorites': 'Favorites',
    'nav.profile': 'Profile',
    'common.video': 'Video',
    'common.shorts': 'Shorts',
    'home.greeting': 'Hi, {name}!',
    'home.searchPlaceholder': 'Search by title or category',
    'home.allCategories': 'All categories',
    'home.allAges': 'All ages',
    'home.feedLoadError': 'Failed to load feed. Try refreshing the page.',
    'home.feedEmpty': 'No videos found for selected filters.',
    'favorites.title': 'Favorites',
    'favorites.loginRequired': 'Sign in to save and watch favorite videos.',
    'favorites.empty': 'You have not added any favorites yet.',
    'categories.title': 'Categories',
    'categories.subtitle': 'Choose a video category',
    'categories.videoCount': '{count} videos',
    'profile.title': 'Profile',
    'profile.interests': 'Interests:',
    'profile.videos': 'Videos',
    'profile.tests': 'Tests',
    'profile.favorites': 'Favorites',
    'profile.language': 'Language',
    'profile.history': 'Watch history',
    'profile.settings': 'Settings',
    'profile.parental': 'Parental control',
    'profile.switch': 'Switch profile',
    'profile.noChildTitle': 'Child profile not created',
    'profile.noChildDescription': 'Create a profile to open parental controls.',
    'profile.createChild': 'Create profile',
    'language.title': 'Language',
    'language.subtitle': 'Choose interface language',
    'language.save': 'Save',
    'language.saved': 'Language updated',
    'language.saveError': 'Failed to update language',
    'language.ru': 'Russian',
    'language.en': 'English',
    'language.ky': 'Kyrgyz',
    'shorts.title': 'Shorts',
    'shorts.openVideo': 'Open video',
    'shorts.nowPlaying': 'Now playing',
    'shorts.swipeHint': 'Swipe up/down',
    'shorts.favoriteBadge': 'In favorites',
    'shorts.empty': 'No short videos for this profile yet.',
    'history.title': 'Watch history',
    'history.subtitle': 'Recently watched videos and shorts',
    'history.empty': 'History is empty. Open any video or shorts and it will appear here.'
  },
  ky: {
    'nav.home': 'Башкы',
    'nav.shorts': 'Shorts',
    'nav.categories': 'Бөлүмдөр',
    'nav.favorites': 'Тандалгандар',
    'nav.profile': 'Профиль',
    'common.video': 'Видео',
    'common.shorts': 'Shorts',
    'home.greeting': 'Салам, {name}!',
    'home.searchPlaceholder': 'Аталышы же категориясы боюнча издөө',
    'home.allCategories': 'Бардык категориялар',
    'home.allAges': 'Бардык курактар',
    'home.feedLoadError': 'Лентаны жүктөө мүмкүн болгон жок. Баракты жаңыртып көрүңүз.',
    'home.feedEmpty': 'Тандалган чыпкалар боюнча видео табылган жок.',
    'favorites.title': 'Тандалгандар',
    'favorites.loginRequired': 'Тандалган видеолорду сактоо үчүн аккаунтка кириңиз.',
    'favorites.empty': 'Азырынча тандалган видео жок.',
    'categories.title': 'Бөлүмдөр',
    'categories.subtitle': 'Видео категориясын тандаңыз',
    'categories.videoCount': '{count} видео',
    'profile.title': 'Профиль',
    'profile.interests': 'Кызыгуулары:',
    'profile.videos': 'Видео',
    'profile.tests': 'Тесттер',
    'profile.favorites': 'Тандалгандар',
    'profile.language': 'Тил',
    'profile.history': 'Көрүү тарыхы',
    'profile.settings': 'Жөндөөлөр',
    'profile.parental': 'Ата-эне көзөмөлү',
    'profile.switch': 'Профилди алмаштыруу',
    'profile.noChildTitle': 'Баланын профили түзүлгөн эмес',
    'profile.noChildDescription': 'Ата-эне көзөмөлүн ачуу үчүн профиль түзүңүз.',
    'profile.createChild': 'Профиль түзүү',
    'language.title': 'Тил',
    'language.subtitle': 'Интерфейс тилин тандаңыз',
    'language.save': 'Сактоо',
    'language.saved': 'Тил жаңыртылды',
    'language.saveError': 'Тилди жаңыртуу мүмкүн болгон жок',
    'language.ru': 'Орусча',
    'language.en': 'Англисче',
    'language.ky': 'Кыргызча',
    'shorts.title': 'Shorts',
    'shorts.openVideo': 'Видеону ачуу',
    'shorts.nowPlaying': 'Азыр ойноп жатат',
    'shorts.swipeHint': 'Жогору/ылдый жылдырыңыз',
    'shorts.favoriteBadge': 'Тандалгандарда',
    'shorts.empty': 'Бул профиль үчүн short-видеолор азырынча жок.',
    'history.title': 'Көрүү тарыхы',
    'history.subtitle': 'Акыркы көрүлгөн видео жана shorts',
    'history.empty': 'Тарых бош. Каалаган видео же shorts ачыңыз, бул жерде чыгат.'
  }
};

export function isLocale(value: string | null | undefined): value is Locale {
  return value ? LOCALES.includes(value as Locale) : false;
}

export function translate(locale: Locale, key: string, vars?: Record<string, string | number>) {
  const template = messagesByLocale[locale][key] ?? messagesByLocale[DEFAULT_LOCALE][key] ?? key;
  if (!vars) return template;

  return template.replace(/\{(\w+)\}/g, (_, name: string) => String(vars[name] ?? `{${name}}`));
}
